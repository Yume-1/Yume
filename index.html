<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yume - Social Media App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* All your CSS styles from before remain exactly the same */
        :root {
            --primary-color: #e91e63;
            --primary-light: #f8bbd0;
            --primary-dark: #ad1457;
            --secondary-color: #03a9f4;
            --text-color: #333;
            --bg-color: #f5f5f5;
            --card-bg: #ffffff;
            --border-color: #e0e0e0;
            --success-color: #4caf50;
            --error-color: #f44336;
            --warning-color: #ff9800;
            --shadow: 0 2px 4px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
        }

        [data-theme="dark"] {
            --text-color: #f5f5f5;
            --bg-color: #121212;
            --card-bg: #1e1e1e;
            --border-color: #333;
            --shadow: 0 2px 4px rgba(0,0,0,0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: var(--transition);
            padding-bottom: 60px;
        }

        /* ... (include ALL your previous CSS styles here) ... */
        
        /* Add any missing styles from your original CSS */
    </style>
</head>
<body>
    <!-- Your HTML structure remains exactly the same -->
    <header class="header">
        <div class="logo-container">
            <div class="logo">Y</div>
            <div class="logo-text">Yume</div>
        </div>
        <button class="theme-toggle" id="themeToggle">ðŸŒ™</button>
    </header>

    <main class="container">
        <section id="homePage" class="page active">
            <h2 class="text-center">Your Feed</h2>
            <div id="feedContainer">
                <div class="spinner"></div>
            </div>
        </section>

        <section id="messagesPage" class="page">
            <h2 class="text-center">Messages</h2>
            <div id="conversationsContainer">
                <div class="spinner"></div>
            </div>
        </section>

        <section id="chatPage" class="page">
            <div class="chat-header">
                <button id="backToMessages" class="back-btn"><i class="fas fa-arrow-left"></i></button>
                <h3 id="chatUserName">User Name</h3>
                <div class="call-buttons">
                    <button class="btn btn-primary" id="voiceCallBtn"><i class="fas fa-phone"></i></button>
                    <button class="btn btn-secondary" id="videoCallBtn"><i class="fas fa-video"></i></button>
                </div>
            </div>
            <div class="message-thread" id="messageThread">
                <div class="spinner"></div>
            </div>
            <div class="message-input">
                <input type="text" id="messageInput" placeholder="Type a message...">
                <button id="sendMessageBtn" class="btn btn-primary"><i class="fas fa-paper-plane"></i></button>
            </div>
        </section>

        <section id="newPostPage" class="page">
            <h2 class="text-center">Create Post</h2>
            <form id="newPostForm">
                <div class="form-group">
                    <textarea class="form-input form-textarea" id="postContent" placeholder="What's on your mind? (280 characters max)" maxlength="280" required></textarea>
                </div>
                <div class="form-group">
                    <input type="file" id="postImage" accept="image/*" class="form-input">
                </div>
                <button type="submit" class="btn btn-primary btn-block">Post</button>
            </form>
        </section>

        <section id="notificationsPage" class="page">
            <h2 class="text-center">Notifications</h2>
            <div id="notificationsContainer">
                <div class="spinner"></div>
            </div>
        </section>

        <section id="profilePage" class="page">
            <div class="profile-header">
                <img src="" alt="Profile" class="profile-avatar" id="profileAvatar">
                <h2 id="profileName">User Name</h2>
                <p id="profileBio">Bio goes here</p>
                <button class="btn btn-primary mt-1" id="editProfileBtn">Edit Profile</button>
                <button class="btn btn-secondary mt-1" id="logoutBtn">Logout</button>
            </div>
            <div class="profile-stats">
                <div class="stat" id="postsStat">
                    <div class="stat-value" id="postsCount">0</div>
                    <div class="stat-label">Posts</div>
                </div>
                <div class="stat" id="followingStat">
                    <div class="stat-value" id="followingCount">0</div>
                    <div class="stat-label">Following</div>
                </div>
                <div class="stat" id="followersStat">
                    <div class="stat-value" id="followersCount">0</div>
                    <div class="stat-label">Followers</div>
                </div>
            </div>
            <div id="userPostsContainer">
                <div class="spinner"></div>
            </div>
        </section>

        <section id="searchPage" class="page">
            <h2 class="text-center">Search</h2>
            <div class="search-container">
                <input type="text" class="search-input" id="searchInput" placeholder="Search users...">
            </div>
            <div id="searchResults">
                <p class="text-center">Start typing to search for users</p>
            </div>
        </section>

        <section id="authPage" class="page">
            <div class="auth-container">
                <div class="auth-tabs">
                    <div class="auth-tab active" data-tab="login">Login</div>
                    <div class="auth-tab" data-tab="register">Register</div>
                </div>
                
                <form id="loginForm" class="auth-form">
                    <div class="form-group">
                        <input type="email" class="form-input" id="loginEmail" placeholder="Email" required>
                    </div>
                    <div class="form-group">
                        <input type="password" class="form-input" id="loginPassword" placeholder="Password" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">Login</button>
                    <div class="text-center mt-2">
                        <button type="button" class="btn btn-secondary" id="googleLogin">Login with Google</button>
                    </div>
                    <div class="text-center mt-2">
                        <button type="button" id="demoLogin">Demo Login</button>
                    </div>
                </form>

                <form id="registerForm" class="auth-form" style="display: none;">
                    <div class="form-group">
                        <input type="text" class="form-input" id="registerName" placeholder="Full Name" required>
                    </div>
                    <div class="form-group">
                        <input type="email" class="form-input" id="registerEmail" placeholder="Email" required>
                    </div>
                    <div class="form-group">
                        <input type="password" class="form-input" id="registerPassword" placeholder="Password" required>
                    </div>
                    <div class="form-group">
                        <input type="password" class="form-input" id="registerConfirmPassword" placeholder="Confirm Password" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">Register</button>
                </form>
            </div>
        </section>
    </main>

    <nav class="bottom-nav">
        <div class="nav-item active" data-page="homePage">
            <div class="nav-icon"><i class="fas fa-home"></i></div>
            <span>Home</span>
        </div>
        <div class="nav-item" data-page="messagesPage">
            <div class="nav-icon"><i class="fas fa-comments"></i></div>
            <span>Messages</span>
        </div>
        <div class="nav-item" data-page="newPostPage">
            <div class="nav-icon"><i class="fas fa-plus-square"></i></div>
            <span>New Post</span>
        </div>
        <div class="nav-item" data-page="notificationsPage">
            <div class="nav-icon"><i class="fas fa-bell"></i>
                <span class="badge" id="notificationBadge" style="display: none;">0</span>
            </div>
            <span>Notifications</span>
        </div>
        <div class="nav-item" data-page="profilePage">
            <div class="nav-icon"><i class="fas fa-user"></i></div>
            <span>Profile</span>
        </div>
    </nav>

    <!-- Modals remain the same -->
    <div class="modal-backdrop" id="editProfileModal" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3>Edit Profile</h3>
                <button class="close-btn">&times;</button>
            </div>
            <form id="editProfileForm">
                <div class="form-group">
                    <input type="text" class="form-input" id="editDisplayName" placeholder="Display Name" required>
                </div>
                <div class="form-group">
                    <textarea class="form-input form-textarea" id="editBio" placeholder="Bio"></textarea>
                </div>
                <div class="form-group">
                    <input type="file" id="editAvatar" accept="image/*" class="form-input">
                </div>
                <button type="submit" class="btn btn-primary btn-block">Save Changes</button>
            </form>
        </div>
    </div>

    <div class="modal-backdrop" id="commentModal" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3>Comments</h3>
                <button class="close-btn">&times;</button>
            </div>
            <div id="commentsContainer">
                <div class="spinner"></div>
            </div>
            <div class="comment-input">
                <input type="text" id="commentInput" placeholder="Write a comment...">
                <button id="postCommentBtn" class="btn btn-primary">Post</button>
            </div>
        </div>
    </div>

    <script>
        // ========== CONFIGURATION ==========
        // Replace these with your actual Supabase credentials
        const SUPABASE_URL = 'https://your-project-ref.supabase.co';
        const SUPABASE_ANON_KEY = 'your-anon-key';
        
        // Initialize Supabase with error handling
        let supabase;
        try {
            supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            console.log('Supabase initialized');
        } catch (error) {
            console.error('Error initializing Supabase:', error);
            // Fallback to mock data mode
            supabase = null;
        }

        // Mock data for demo when Supabase is not configured
        const mockUsers = [
            {
                id: '1',
                name: 'Alex Johnson',
                email: 'alex@example.com',
                bio: 'Digital artist and photographer',
                avatar: 'https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80',
                createdAt: new Date()
            },
            {
                id: '2', 
                name: 'Sam Smith',
                email: 'sam@example.com',
                bio: 'Travel enthusiast and food lover',
                avatar: 'https://images.unsplash.com/photo-1494790108755-2616b612b786?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80',
                createdAt: new Date()
            }
        ];

        const mockPosts = [
            {
                id: '1',
                user_id: '1',
                content: 'Just finished my latest digital painting! What do you think? ðŸŽ¨',
                image: 'https://images.unsplash.com/photo-1541961017774-22349e4a1262?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80',
                created_at: new Date(Date.now() - 2 * 60 * 60 * 1000),
                profiles: { name: 'Alex Johnson', avatar: mockUsers[0].avatar },
                likes: [{ user_id: '2' }],
                comments: [
                    { id: '1', user_id: '2', content: 'Amazing work!', created_at: new Date(), profiles: { name: 'Sam Smith', avatar: mockUsers[1].avatar } }
                ]
            }
        ];

        let mockDB = {
            users: [...mockUsers],
            posts: [...mockPosts],
            messages: [],
            notifications: [],
            follows: []
        };

        // State Management
        let currentUser = null;
        let currentTheme = localStorage.getItem('theme') || 'light';
        let currentPage = 'homePage';
        let currentPostId = null;
        let currentChatUser = null;
        let useMockData = !supabase; // Use mock data if Supabase not configured

        // ========== INITIALIZATION ==========
        function initApp() {
            console.log('Initializing app...');
            setTheme(currentTheme);
            setupEventListeners();
            checkAuthStatus();
        }

        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            document.getElementById('themeToggle').innerHTML = theme === 'light' ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
        }

        async function checkAuthStatus() {
            if (useMockData) {
                // Show auth page for mock mode
                showPage('authPage');
                return;
            }

            try {
                const { data: { session }, error } = await supabase.auth.getSession();
                
                if (error) {
                    console.error('Auth session error:', error);
                    showPage('authPage');
                    return;
                }
                
                if (session) {
                    currentUser = session.user;
                    await loadUserProfile();
                    showPage('homePage');
                    await loadFeed();
                    await updateUnreadCount();
                    setupRealtimeSubscriptions();
                } else {
                    showPage('authPage');
                }
            } catch (error) {
                console.error('Error checking auth status:', error);
                showPage('authPage');
            }
        }

        // ========== EVENT LISTENERS ==========
        function setupEventListeners() {
            // Navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    const pageId = item.getAttribute('data-page');
                    showPage(pageId);
                });
            });
            
            // Theme toggle
            document.getElementById('themeToggle').addEventListener('click', () => {
                currentTheme = currentTheme === 'light' ? 'dark' : 'light';
                setTheme(currentTheme);
            });
            
            // Auth tabs
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.getAttribute('data-tab');
                    document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    document.getElementById('loginForm').style.display = tabName === 'login' ? 'block' : 'none';
                    document.getElementById('registerForm').style.display = tabName === 'register' ? 'block' : 'none';
                });
            });
            
            // Login form
            document.getElementById('loginForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                await loginUser(email, password);
            });
            
            // Demo login
            document.getElementById('demoLogin').addEventListener('click', () => {
                useMockData = true;
                currentUser = mockUsers[0];
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                showPage('homePage');
                loadFeed();
                alert('Demo mode activated! Using mock data.');
            });
            
            // Register form
            document.getElementById('registerForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const name = document.getElementById('registerName').value;
                const email = document.getElementById('registerEmail').value;
                const password = document.getElementById('registerPassword').value;
                const confirmPassword = document.getElementById('registerConfirmPassword').value;
                
                if (password !== confirmPassword) {
                    alert('Passwords do not match');
                    return;
                }
                
                await registerUser(name, email, password);
            });
            
            // Google login
            document.getElementById('googleLogin').addEventListener('click', async () => {
                if (useMockData) {
                    currentUser = mockUsers[1];
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    showPage('homePage');
                    loadFeed();
                    alert('Mock Google login successful!');
                } else {
                    await signInWithGoogle();
                }
            });
            
            // New post form
            document.getElementById('newPostForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const content = document.getElementById('postContent').value;
                const imageFile = document.getElementById('postImage').files[0];
                await createPost(content, imageFile);
            });
            
            // Edit profile
            document.getElementById('editProfileBtn').addEventListener('click', showEditProfileModal);
            document.getElementById('logoutBtn').addEventListener('click', logoutUser);
            
            // Close modals
            document.querySelectorAll('.close-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.getElementById('editProfileModal').style.display = 'none';
                    document.getElementById('commentModal').style.display = 'none';
                });
            });
            
            // Edit profile form
            document.getElementById('editProfileForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const displayName = document.getElementById('editDisplayName').value;
                const bio = document.getElementById('editBio').value;
                const avatarFile = document.getElementById('editAvatar').files[0];
                await updateProfile(displayName, bio, avatarFile);
            });
            
            // Messages
            document.getElementById('backToMessages').addEventListener('click', () => showPage('messagesPage'));
            document.getElementById('sendMessageBtn').addEventListener('click', sendMessage);
            document.getElementById('messageInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendMessage();
            });
            
            // Comments
            document.getElementById('postCommentBtn').addEventListener('click', postComment);
            document.getElementById('commentInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') postComment();
            });
            
            // Search
            document.getElementById('searchInput').addEventListener('input', handleSearch);
            
            // Profile stats
            document.getElementById('postsStat').addEventListener('click', () => {
                document.getElementById('userPostsContainer').scrollIntoView({ behavior: 'smooth' });
            });
            
            // Call buttons (simplified)
            document.getElementById('voiceCallBtn').addEventListener('click', () => {
                alert('Voice call feature would be implemented with WebRTC');
            });
            
            document.getElementById('videoCallBtn').addEventListener('click', () => {
                alert('Video call feature would be implemented with WebRTC');
            });
        }

        // ========== PAGE MANAGEMENT ==========
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            currentPage = pageId;
            
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-page') === pageId) {
                    item.classList.add('active');
                }
            });
            
            // Load page-specific content
            switch(pageId) {
                case 'homePage': loadFeed(); break;
                case 'profilePage': loadProfile(); break;
                case 'notificationsPage': loadNotifications(); break;
                case 'messagesPage': loadConversations(); break;
                case 'searchPage': initSearch(); break;
            }
        }

        // ========== AUTHENTICATION ==========
        async function loadUserProfile() {
            if (useMockData) return;
            
            try {
                const { data: profile, error } = await supabase
                    .from('profiles')
                    .select('*')
                    .eq('id', currentUser.id)
                    .single();

                if (error && error.code !== 'PGRST116') throw error;

                if (!profile) {
                    // Create profile
                    const { error: insertError } = await supabase
                        .from('profiles')
                        .insert([{
                            id: currentUser.id,
                            name: currentUser.email.split('@')[0],
                            bio: '',
                            avatar: `https://ui-avatars.com/api/?name=${encodeURIComponent(currentUser.email.split('@')[0])}&background=random`
                        }]);
                    if (insertError) throw insertError;
                }
            } catch (error) {
                console.error('Error loading profile:', error);
            }
        }

        async function signInWithGoogle() {
            if (useMockData) return;
            
            const { error } = await supabase.auth.signInWithOAuth({
                provider: 'google',
            });
            if (error) alert('Google login error: ' + error.message);
        }

        async function loginUser(email, password) {
            if (useMockData) {
                // Mock login for demo
                const user = mockUsers.find(u => u.email === email);
                if (user && password === 'password') {
                    currentUser = user;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    showPage('homePage');
                    loadFeed();
                    alert('Login successful! (Demo mode)');
                } else {
                    alert('Use any email with password "password" for demo');
                }
                return;
            }

            const { data, error } = await supabase.auth.signInWithPassword({ email, password });
            if (error) {
                alert('Login error: ' + error.message);
            } else {
                currentUser = data.user;
                await loadUserProfile();
                showPage('homePage');
                await loadFeed();
                alert('Login successful!');
            }
        }

        async function registerUser(name, email, password) {
            if (useMockData) {
                alert('Registration would create a real account in production');
                return;
            }

            const { data, error } = await supabase.auth.signUp({
                email,
                password,
                options: { data: { name } }
            });
            
            if (error) {
                alert('Registration error: ' + error.message);
            } else {
                alert('Registration successful! Please check your email.');
                // Switch to login
                document.querySelector('.auth-tab[data-tab="login"]').click();
            }
        }

        async function logoutUser() {
            if (useMockData) {
                currentUser = null;
                localStorage.removeItem('currentUser');
                showPage('authPage');
                return;
            }

            const { error } = await supabase.auth.signOut();
            if (error) {
                alert('Logout error: ' + error.message);
            } else {
                currentUser = null;
                showPage('authPage');
            }
        }

        // ========== POSTS & FEED ==========
        async function loadFeed() {
            const container = document.getElementById('feedContainer');
            
            if (!currentUser) {
                container.innerHTML = `
                    <div class="card login-prompt">
                        <i class="fas fa-rss"></i>
                        <h3>Login to see your feed</h3>
                        <button class="btn btn-primary mt-1" onclick="showPage('authPage')">Login</button>
                    </div>
                `;
                return;
            }

            container.innerHTML = '<div class="spinner"></div>';

            if (useMockData) {
                // Use mock data
                setTimeout(() => {
                    container.innerHTML = '';
                    mockPosts.forEach(post => {
                        container.appendChild(createPostElement(post));
                    });
                }, 1000);
                return;
            }

            try {
                // Real Supabase implementation
                const { data: posts, error } = await supabase
                    .from('posts')
                    .select(`
                        *,
                        profiles:user_id (name, avatar),
                        likes (user_id),
                        comments (id, user_id, content, created_at, profiles:user_id (name, avatar))
                    `)
                    .order('created_at', { ascending: false });

                if (error) throw error;

                container.innerHTML = '';
                if (posts && posts.length > 0) {
                    posts.forEach(post => container.appendChild(createPostElement(post)));
                } else {
                    container.innerHTML = '<p class="text-center">No posts yet</p>';
                }
            } catch (error) {
                console.error('Error loading feed:', error);
                container.innerHTML = '<p class="text-center">Error loading feed</p>';
            }
        }

        function createPostElement(post) {
            const isLiked = post.likes?.some(like => like.user_id === currentUser?.id);
            const likeCount = post.likes?.length || 0;
            const commentCount = post.comments?.length || 0;

            const element = document.createElement('div');
            element.className = 'card post-card';
            element.innerHTML = `
                <div class="user-info">
                    <img src="${post.profiles.avatar}" alt="${post.profiles.name}" class="avatar">
                    <div>
                        <div class="username">${post.profiles.name}</div>
                        <div class="timestamp">${formatDate(post.created_at)}</div>
                    </div>
                </div>
                <div class="post-content">
                    <p>${post.content}</p>
                    ${post.image ? `<img src="${post.image}" class="post-image">` : ''}
                </div>
                <div class="post-actions">
                    <button class="action-btn ${isLiked ? 'liked' : ''}">
                        <i class="fas fa-heart"></i> <span>${likeCount}</span>
                    </button>
                    <button class="action-btn">
                        <i class="fas fa-comment"></i> <span>${commentCount}</span>
                    </button>
                    <button class="action-btn"><i class="fas fa-share"></i></button>
                </div>
            `;

            // Add event listeners
            const likeBtn = element.querySelector('.action-btn:first-child');
            likeBtn.addEventListener('click', () => toggleLike(post.id));

            const commentBtn = element.querySelectorAll('.action-btn')[1];
            commentBtn.addEventListener('click', () => showComments(post.id));

            return element;
        }

        async function createPost(content, imageFile) {
            if (!currentUser) {
                alert('Please login first');
                showPage('authPage');
                return;
            }

            if (useMockData) {
                // Mock post creation
                const newPost = {
                    id: Date.now().toString(),
                    user_id: currentUser.id,
                    content,
                    image: imageFile ? 'https://images.unsplash.com/photo-1579546929662-711aa81148cf?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80' : null,
                    created_at: new Date(),
                    profiles: { name: currentUser.name, avatar: currentUser.avatar },
                    likes: [],
                    comments: []
                };
                mockPosts.unshift(newPost);
                document.getElementById('newPostForm').reset();
                showPage('homePage');
                loadFeed();
                alert('Post created! (Demo mode)');
                return;
            }

            // Real implementation would go here
            alert('Post creation would work with real Supabase setup');
        }

        // ========== UTILITY FUNCTIONS ==========
        function formatDate(date) {
            const diff = new Date() - new Date(date);
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            
            if (minutes < 1) return 'Just now';
            if (minutes < 60) return `${minutes}m ago`;
            if (hours < 24) return `${hours}h ago`;
            if (days < 7) return `${days}d ago`;
            return new Date(date).toLocaleDateString();
        }

        function formatTime(date) {
            return new Date(date).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        // ========== PLACEHOLDER FUNCTIONS ==========
        // These would be fully implemented in a production app
        async function toggleLike(postId) {
            alert('Like functionality would be implemented');
        }

        async function showComments(postId) {
            alert('Comment modal would open');
        }

        async function postComment() {
            alert('Comment would be posted');
        }

        async function loadProfile() {
            if (!currentUser) {
                showPage('authPage');
                return;
            }
            document.getElementById('profileName').textContent = currentUser.name;
            document.getElementById('profileBio').textContent = currentUser.bio || 'No bio yet';
            document.getElementById('profileAvatar').src = currentUser.avatar;
            // Load user posts...
        }

        async function loadNotifications() {
            document.getElementById('notificationsContainer').innerHTML = '<p class="text-center">No notifications</p>';
        }

        async function loadConversations() {
            document.getElementById('conversationsContainer').innerHTML = '<p class="text-center">No conversations</p>';
        }

        async function loadChat(user) {
            document.getElementById('messageThread').innerHTML = '<p class="text-center">No messages yet</p>';
        }

        async function sendMessage() {
            alert('Message would be sent');
        }

        function initSearch() {
            document.getElementById('searchResults').innerHTML = '<p class="text-center">Start typing to search</p>';
        }

        async function handleSearch() {
            document.getElementById('searchResults').innerHTML = '<p class="text-center">Search results would appear here</p>';
        }

        function showEditProfileModal() {
            document.getElementById('editDisplayName').value = currentUser.name;
            document.getElementById('editBio').value = currentUser.bio || '';
            document.getElementById('editProfileModal').style.display = 'flex';
        }

        async function updateProfile(name, bio, avatarFile) {
            if (useMockData) {
                currentUser.name = name;
                currentUser.bio = bio;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                document.getElementById('editProfileModal').style.display = 'none';
                loadProfile();
                alert('Profile updated! (Demo mode)');
                return;
            }
            alert('Profile would be updated in Supabase');
        }

        async function updateUnreadCount() {
            // Would update notification badge
        }

        function setupRealtimeSubscriptions() {
            if (useMockData || !supabase) return;
            // Would set up real-time subscriptions
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>